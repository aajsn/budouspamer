<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>Discord Web Controller v1.1</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f0f2f5; display: flex; justify-content: center; padding: 20px; }
        .container { background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); width: 450px; }
        h2 { color: #333; font-size: 20px; border-bottom: 2px solid #eee; padding-bottom: 10px; margin-top: 0; }
        .field { margin-bottom: 15px; }
        label { display: block; font-size: 13px; font-weight: bold; margin-bottom: 5px; color: #555; }
        input[type="text"], input[type="number"], textarea { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; }
        textarea { height: 60px; resize: vertical; }
        .row { display: flex; gap: 10px; }
        .btn { width: 100%; padding: 12px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; transition: 0.3s; }
        .start-btn { background-color: #007bff; color: white; margin-top: 10px; }
        .start-btn:hover { background-color: #0056b3; }
        .stop-btn { background-color: #dc3545; color: white; margin-top: 10px; display: none; }
        #log { margin-top: 15px; font-size: 12px; max-height: 150px; overflow-y: auto; background: #f8f9fa; padding: 10px; border-radius: 4px; border: 1px solid #eee; }
        .status-bar { font-size: 11px; color: #888; margin-top: 5px; text-align: right; }
    </style>
</head>
<body>

<div class="container">
    <h2>Discord Console v1.1</h2>
    
    <div class="field">
        <label>USER TOKEN</label>
        <input type="text" id="token" placeholder="mfa.xxxx...">
    </div>

    <div class="field">
        <label>CHANNEL ID</label>
        <input type="text" id="channelId" placeholder="1234567890...">
    </div>

    <div class="row">
        <div class="field">
            <label>MIN DELAY (sec)</label>
            <input type="number" id="minDelay" value="2.5" step="0.1">
        </div>
        <div class="field">
            <label>MAX DELAY (sec)</label>
            <input type="number" id="maxDelay" value="6.0" step="0.1">
        </div>
        <div class="field">
            <label>LIMIT (0=∞)</label>
            <input type="number" id="limit" value="10">
        </div>
    </div>

    <div class="field">
        <label>MSG PATTERNS (1 line per message)</label>
        <textarea id="patterns" placeholder="Pattern 1&#13;&#10;Pattern 2&#13;&#10;Pattern 3"></textarea>
    </div>

    <div class="field">
        <label>SEND MODE</label>
        <select id="mode" style="width: 100%; padding: 8px; border-radius: 6px; border: 1px solid #ddd;">
            <option value="random">RANDOM (ランダム)</option>
            <option value="order">ORDER (順番)</option>
        </select>
    </div>

    <button class="btn start-btn" id="startBtn">START SESSION</button>
    <button class="btn stop-btn" id="stopBtn">STOP SESSION</button>

    <div id="log">Logs: Ready...</div>
    <div class="status-bar" id="status">Remaining: -</div>
</div>

<script>
    let isRunning = false;
    let timer = null;
    let currentIndex = 0;
    let sentCount = 0;

    const log = (msg) => {
        const logBox = document.getElementById('log');
        logBox.innerHTML += `<div>[${new Date().toLocaleTimeString()}] ${msg}</div>`;
        logBox.scrollTop = logBox.scrollHeight;
    };

    async function sendMessage() {
        if (!isRunning) return;

        const limit = parseInt(document.getElementById('limit').value);
        if (limit > 0 && sentCount >= limit) {
            log("Limit reached. Finished.");
            stop();
            return;
        }

        const token = document.getElementById('token').value;
        const channelId = document.getElementById('channelId').value;
        const patterns = document.getElementById('patterns.value').split('\n').filter(p => p.trim() !== "");
        const mode = document.getElementById('mode').value;
        const min = parseFloat(document.getElementById('minDelay').value) * 1000;
        const max = parseFloat(document.getElementById('maxDelay').value) * 1000;

        let content = (mode === "random") 
            ? patterns[Math.floor(Math.random() * patterns.length)]
            : patterns[currentIndex];

        try {
            const response = await fetch(`https://discord.com/api/v9/channels/${channelId}/messages`, {
                method: 'POST',
                headers: { 'Authorization': token, 'Content-Type': 'application/json' },
                body: JSON.stringify({ content: content })
            });

            if (response.status === 200) {
                sentCount++;
                currentIndex = (currentIndex + 1) % patterns.length;
                log(`[${sentCount}] Sent: ${content}`);
                if (limit > 0) document.getElementById('status').innerText = `Remaining: ${limit - sentCount}`;
            } else if (response.status === 429) {
                log("Rate limited! Waiting...");
            } else {
                log(`Error: ${response.status}`);
            }
        } catch (e) {
            log("Connection error.");
        }

        if (limit > 0 && sentCount >= limit) {
            log("Task complete.");
            stop();
            return;
        }

        const nextDelay = Math.floor(Math.random() * (max - min + 1)) + min;
        timer = setTimeout(sendMessage, nextDelay);
    }

    document.getElementById('startBtn').addEventListener('click', () => {
        sentCount = 0;
        currentIndex = 0;
        isRunning = true;
        document.getElementById('startBtn').style.display = 'none';
        document.getElementById('stopBtn').style.display = 'block';
        log("Started.");
        sendMessage();
    });

    function stop() {
        isRunning = false;
        clearTimeout(timer);
        document.getElementById('startBtn').style.display = 'block';
        document.getElementById('stopBtn').style.display = 'none';
        document.getElementById('status').innerText = "Stopped.";
    }

    document.getElementById('stopBtn').addEventListener('click', stop);
</script>

</body>
</html>
