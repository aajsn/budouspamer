　<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>Discord Multi-Tool v2</title>
    <style>
        body { font-family: sans-serif; background: #2c2f33; color: white; padding: 20px; max-width: 500px; margin: auto; }
        input, textarea { width: 100%; padding: 10px; margin: 8px 0; border-radius: 5px; border: 1px solid #444; background: #23272a; color: white; box-sizing: border-box; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        button { width: 100%; background: #7289da; color: white; padding: 12px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; margin-top: 10px; }
        button:hover { background: #677bc4; }
        button.stop { background: #f04747; }
        #status { margin-top: 15px; padding: 10px; border-radius: 5px; font-size: 0.9em; min-height: 20px; }
        .success { background: #43b581; }
        .error { background: #f04747; }
        .warning { background: #faa61a; color: black; }
    </style>
</head>
<body>
    <h2>Discord Send Tool (Anti-Limit)</h2>
    
    <label>Token</label>
    <input type="password" id="token" placeholder="Discord Token">
    
    <label>Channel ID</label>
    <input type="text" id="channelId" placeholder="Channel ID">
    
    <label>Message</label>
    <textarea id="message" rows="3" placeholder="Hello!"></textarea>

    <div class="grid">
        <div>
            <label>回数</label>
            <input type="number" id="count" value="500" min="1">
        </div>
        <div>
            <label>間隔 (ms)</label>
            <input type="number" id="delay" value="1000" min="100">
        </div>
    </div>

    <button id="sendBtn" onclick="startSending()">送信開始</button>
    <button id="stopBtn" class="stop" onclick="stopSending()" style="display:none;">停止</button>

    <div id="status"></div>

    <script>
        let isSending = false;

        function updateStatus(text, type) {
            const status = document.getElementById('status');
            status.innerText = text;
            status.className = type || '';
        }

        function stopSending() {
            isSending = false;
            updateStatus("停止しました", "warning");
        }

        async function startSending() {
            if (isSending) return;

            const token = document.getElementById('token').value;
            const channelId = document.getElementById('channelId').value;
            const message = document.getElementById('message').value;
            const count = parseInt(document.getElementById('count').value);
            const delay = parseInt(document.getElementById('delay').value);

            if (!token || !channelId || !message) {
                updateStatus("エラー: 入力項目が不足", "error");
                return;
            }

            isSending = true;
            document.getElementById('sendBtn').style.display = 'none';
            document.getElementById('stopBtn').style.display = 'block';

            for (let i = 0; i < count; i++) {
                if (!isSending) break;

                updateStatus(`送信中: ${i + 1} / ${count}`);

                try {
                    const response = await fetch(`https://discord.com/api/v9/channels/${channelId}/messages`, {
                        method: 'POST',
                        headers: {
                            'Authorization': token,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ content: message })
                    });

                    if (response.status === 429) {
                        const limitData = await response.json();
                        const retryAfter = (limitData.retry_after || 5) * 1000;
                        updateStatus(`制限中... ${limitData.retry_after}秒待機して再開します`, "warning");
                        await new Promise(resolve => setTimeout(resolve, retryAfter));
                        i--; // 回数をカウントしないように戻す
                        continue;
                    }

                    if (!response.ok) {
                        updateStatus(`エラー発生 (Status: ${response.status})`, "error");
                        break;
                    }
                } catch (err) {
                    updateStatus("通信エラー", "error");
                    break;
                }

                await new Promise(resolve => setTimeout(resolve, delay));
            }

            isSending = false;
            document.getElementById('sendBtn').style.display = 'block';
            document.getElementById('stopBtn').style.display = 'none';
            if (status.className !== "warning") updateStatus("完了！", "success");
        }
    </script>
</body>
</html>
